#+TITLE: jsec News
#+AUTHOR: llmII
#+OPTIONS: toc:2 num:nil

* News

** 2025-12-26 - Windows IOCP Support Complete

Windows is now fully supported with all tests passing:

*** Windows Platform Status
- All 1119 tests pass (960 Unix socket tests automatically skipped)
- Build via MSVC (Visual Studio 2022) with vcpkg OpenSSL
- IOCP event loop integration complete

*** Key Fixes
- Fixed connection error detection on Windows
  - Windows ~WSAConnect~ returns success immediately, errors on first I/O
  - Updated tests to write after connect for cross-platform consistency
- DTLS client refactored to use memory BIOs for Windows compatibility
- Fixed ~getpeername~ check on INIT to properly detect pending connections

*** clang-format Configuration
- ~IndentPPDirectives: None~ - preprocessor directives at column 0
- Code inside ~#ifdef~ blocks maintains normal indentation

** 2025-12-24 - OpenBSD LibreSSL Support & Code Quality Improvements

OpenBSD is now fully supported with all tests passing:

*** OpenBSD (LibreSSL 3.9+)
- Fixed TLS hang in ~accept-loop~ test caused by premature WANT_READ returns
- Added do-while loop in ~jtls_attempt_io~ to retry operations when BIO buffer has unread data
- Prevents yielding to event loop when local buffered data can satisfy reads
- All 1934 tests now pass on OpenBSD 7.6

*** Code Quality Improvements
- Migrated from astyle to clang-format for C code formatting
- Consistent K&R style with 4-space indentation, 78/80 column limits
- Improved buffer allocation code clarity with better variable naming
- Added ~check-format-c~ task to verify formatting compliance
- Updated CONTRIBUTING documentation

*** Buffer Management
- Clarified ~janet_buffer_ensure~ usage in TLS read operations
- Renamed confusing ~capacity~ variables to ~read_size~ for clarity
- Added comments explaining buffer allocation logic
- No functional changes - existing code was correct

** 2025-12-24 - NetBSD & DragonflyBSD Support

NetBSD and DragonflyBSD are now fully supported with all tests passing:

*** NetBSD (OpenSSL 3.x)
- Tested on NetBSD 10.1
- All 1934 tests pass
- No platform-specific changes needed

*** DragonflyBSD (LibreSSL 3.9+)
- Tested on DragonflyBSD 6.4
- All 1935 tests pass
- Fixed ~BIO_flush~/~BIO_reset~ unused value warnings

*** LibreSSL Compatibility
- LibreSSL support now working across all BSD platforms excluding OpenBSD (WIP)
- Conditional compilation for OpenSSL 3.0 vs LibreSSL APIs

*** OpenBSD Status
- Build and most tests work with LibreSSL 3.9+

** 2025-12-23 - macOS Support via Homebrew OpenSSL

macOS is now fully supported with all tests passing:

*** Requirements
- Homebrew OpenSSL 3.x: ~brew install openssl@3~
- Janet and jpm

** 2025-12-15 - FreeBSD Support & Performance Improvements

All tests continue to pass under Linux and FreeBSD is now fully supported with
all tests passing:

*** FreeBSD Fixes
- Fixed build failures: header order, implicit fallthrough warnings, MSG_DONTWAIT
- Fixed time function calls: use ~clock_gettime~ with ~CLOCK_MONOTONIC~ instead
  of ~gettimeofday~ which isn't available with ~__POSIX_C_SOURCE~
- Fixed DTLS and Unix socket handling for FreeBSD's kqueue-based event loop
- Better shutdown handling with scheduled close operations for TLS streams

*** Performance Improvements
- Embedded ~TLSState~ directly in ~TLSStream~ to eliminate malloc per I/O operation
- Reduced ~memset~ calls in hot paths by only zeroing fields that need reset
- Added ~-O2~ optimization flag to production builds
- Some keywords cached to prevent runtime lookups in hot paths

** 2025-12-13 - OpenSSL 3.0 Compatibility Fixes

Several fixes were made to ensure jsec works correctly with OpenSSL 3.0:

- Fixed ~PEM_read_bio_PrivateKey~ usage to provide explicit empty password
  callback, preventing OpenSSL 3.0 from prompting on TTY for pass phrases
- Extended pass phrase handling to cover cases where a password is expected
  but none is provided
- Fixed ~crypto/key-info~ to detect encrypted keys early and return without
  attempting to parse the private key (which would trigger TTY prompts)
- Fixed ~X509_PURPOSE_CODE_SIGN~ which doesn't exist in OpenSSL 3.0, now
  using alternative approach for code signing purpose verification
- Fixed function name capitalization issue affecting OpenSSL 3.0

These changes ensure jsec works with both OpenSSL 3.0.x and 3.5.x.

** 2025-12-13 - Dependency Update

- Changed spork dependency to use upstream instead of fork, as upstream
  merged the necessary changes for spork-https compatibility

** 2025-12-12 - Initial Release

First release of jsec, a comprehensive TLS/SSL library for Janet providing:

- Full TLS client and server support with modern cipher suites
- X.509 certificate handling (creation, parsing, verification)
- Private key management (RSA, EC, Ed25519, Ed448)
- CSR (Certificate Signing Request) support
- PKCS#12 bundle handling
- CA (Certificate Authority) operations
- Digest functions (SHA-256, SHA-384, SHA-512, etc.)
- HMAC support
- Random number generation
- Base64 encoding/decoding
- Comprehensive error handling

See [[file:README.org][README]] for full documentation and usage examples.
